<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>FreeYourPDF - PDF 加密 / 解锁 / 体积优化</title>
  <link rel="stylesheet" href="css/style.css">
  <!-- 前后端分开启动时，后端 API 地址（默认 5001，避免 macOS 上 5000 被 AirPlay 占用） -->
  <script>window.FREEYOURPDF_API_BASE = 'http://localhost:5001';</script>
</head>
<body>
  <div class="page">
    <header class="header">
      <h1 class="logo">FreeYourPDF</h1>
      <p class="tagline">PDF 加密 · 解锁 · 体积优化</p>
      <div class="usage-row" id="usageRow">
        <div class="usage usage-encrypt">
          <span class="usage-label">加密</span>
          <span class="usage-value" id="usageValueEncrypt">10</span>
          <span class="usage-total">/ 10</span>
        </div>
        <div class="usage usage-unlock">
          <span class="usage-label">解锁</span>
          <span class="usage-value" id="usageValueUnlock">10</span>
          <span class="usage-total">/ 10</span>
        </div>
        <div class="usage usage-compress">
          <span class="usage-label">体积优化</span>
          <span class="usage-value" id="usageValueCompress">10</span>
          <span class="usage-total">/ 10</span>
        </div>
      </div>
    </header>

    <main class="main">
      <nav class="tabs" id="mainTabs" role="tablist">
        <button type="button" class="tab is-active" id="tabEncrypt" role="tab" aria-selected="true" data-tab="encrypt">加密</button>
        <button type="button" class="tab" id="tabUnlock" role="tab" aria-selected="false" data-tab="unlock">解锁</button>
        <button type="button" class="tab" id="tabCompress" role="tab" aria-selected="false" data-tab="compress">体积优化</button>
      </nav>

      <section class="card" id="uploadCard">
        <h2 class="card-title-dynamic" id="cardTitle">选择 PDF 文件（加密）</h2>
        <p class="card-desc card-desc-dynamic" id="cardDesc">支持多选，可对未加密的 PDF 进行加密。<strong>全部在您设备本地处理，文件不上传服务器，隐私与安全有保障。</strong></p>
        <label class="file-label">
          <input type="file" id="pdfInput" accept=".pdf" multiple class="file-input">
          <span class="drop-zone" id="dropZone">
            <span class="drop-zone-icon" aria-hidden="true">
              <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round">
                <path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"/>
                <polyline points="14 2 14 8 20 8"/>
                <line x1="12" y1="18" x2="12" y2="12"/>
                <line x1="9" y1="15" x2="15" y2="15"/>
              </svg>
            </span>
            <span class="drop-zone-text" id="pdfInputText">点击选择或拖入多个 PDF</span>
            <span class="drop-zone-hint">支持多选，仅处理 .pdf 文件</span>
          </span>
        </label>
        <div class="file-list" id="fileList"></div>
        <p class="hint" id="globalHint"></p>
      </section>

      <!-- 后期：支付 / 广告占位 -->
      <section class="card card-extra" id="extraSection" aria-hidden="true">
        <h2>获取更多次数</h2>
        <p class="card-desc">免费次数用完后，可通过以下方式继续使用。</p>
        <div class="extra-placeholder" id="extraPlaceholder">
          <p>支付与广告功能将在后期集成。</p>
        </div>
      </section>
    </main>

    <footer class="footer">
      <p></p>
    </footer>
  </div>

  <!-- 加密选项弹窗 -->
  <div class="modal-overlay" id="encryptModal" aria-hidden="true">
    <div class="modal encrypt-modal">
      <h3 class="modal-title">加密选项</h3>
      <p class="modal-desc">勾选表示「禁止」该项。若勾选「打开需要密码」，请在下方设置密码。</p>

      <div class="modal-section">
        <span class="modal-section-label">限制权限（勾选即禁止）</span>
        <div class="modal-permissions" id="encryptPermissions">
          <label class="checkbox-label"><input type="checkbox" id="encRequirePassword"> 打开需要密码</label>
          <label class="checkbox-label"><input type="checkbox" id="encPermModify" checked> 禁止编辑内容</label>
          <label class="checkbox-label"><input type="checkbox" id="encPermCopy" checked> 禁止复制</label>
          <label class="checkbox-label"><input type="checkbox" id="encPermPrint"> 禁止打印</label>
          <label class="checkbox-label"><input type="checkbox" id="encPermAnnotate" checked> 禁止添加/修改注释</label>
          <label class="checkbox-label"><input type="checkbox" id="encPermFillingForms"> 禁止填写表单</label>
          <label class="checkbox-label"><input type="checkbox" id="encPermContentAccess"> 禁止提取内容（如无障碍复制）</label>
          <label class="checkbox-label"><input type="checkbox" id="encPermAssembly" checked> 禁止组装文档（插/删页、书签等）</label>
        </div>
        <div class="modal-password modal-password-bottom" id="encryptPasswordWrap">
          <label class="modal-label" for="encryptPassword">设置密码</label>
          <input type="password" id="encryptPassword" class="input" placeholder="设置密码" autocomplete="off">
        </div>
      </div>

      <p class="modal-hint modal-hint-error" id="encryptModalHint" aria-hidden="true"></p>
      <div class="modal-actions">
        <button type="button" class="btn btn-secondary" id="encryptModalCancel">取消</button>
        <button type="button" class="btn btn-primary" id="encryptModalConfirm">确认加密</button>
      </div>
    </div>
  </div>

  <!-- 体积优化弹窗：结构与加密弹窗一致 -->
  <div class="modal-overlay" id="compressModal" aria-hidden="true">
    <div class="modal compress-modal">
      <h3 class="modal-title">体积优化</h3>
      <p class="modal-desc">选择压缩模式与图片质量，点击「开始体积优化」后进行处理，成功后可下载。</p>
      <div class="modal-section">
        <span class="modal-section-label">减少文件大小</span>
        <div class="modal-option-row">
          <label class="modal-label" for="compressMode">压缩模式</label>
          <select id="compressMode" class="input input-select">
            <option value="raster" selected>图片重采样（显著缩小，推荐）</option>
            <option value="standard">仅优化结构（几乎不减小体积）</option>
          </select>
        </div>
        <div class="modal-option-row modal-option-row-raster" id="compressRasterQualityRow">
          <label class="modal-label" for="compressRasterQuality">图片质量 <span class="modal-desc-inline">（默认 0.5 推荐：显著减小体积）</span></label>
          <div class="modal-option-field-range">
            <input type="range" id="compressRasterQuality" class="input-range" min="0.5" max="0.95" step="0.05" value="0.5" aria-describedby="compressRasterQualityValue">
            <span class="modal-option-value" id="compressRasterQualityValue" aria-live="polite">0.5</span>
          </div>
        </div>
        <div class="modal-option-row">
          <label class="modal-label" for="compressCompatibility">Acrobat 版本兼容性</label>
          <select id="compressCompatibility" class="input input-select">
            <option value="1.4">Acrobat 5.0 (PDF 1.4)</option>
            <option value="1.5">Acrobat 6.0 (PDF 1.5)</option>
            <option value="1.7" selected>Acrobat 10.0 及更高 (PDF 1.7)</option>
          </select>
        </div>
        <p class="modal-desc modal-desc-tip">
          <span aria-hidden="true">💡</span> 默认参数（分辨率 2×、质量 0.5）显著减小体积；左滑更小更糊，右滑更清晰更大。
        </p>
      </div>
      <div class="modal-actions">
        <button type="button" class="btn btn-secondary" id="compressModalCancel">取消</button>
        <button type="button" class="btn btn-primary" id="compressModalConfirm">开始体积优化</button>
      </div>
    </div>
  </div>

  <!-- 解密选项弹窗（需打开密码时显示，含暴力破解提示） -->
  <div class="modal-overlay" id="decryptModal" aria-hidden="true">
    <div class="modal decrypt-modal">
      <h3 class="modal-title">解密（需打开密码）</h3>
      <p class="modal-desc">将尝试<strong>暴力破解</strong>打开密码（常见密码、1～4 位数字等）。</p>
      <p class="modal-desc modal-desc-warn">破解可能<strong>耗时较长</strong>，且<strong>有一定概率无法破解</strong>；若密码较复杂，建议通过其他方式获取密码后再解密。</p>

      <div class="modal-section">
        <button type="button" class="btn btn-primary btn-block" id="decryptModalCrack">开始暴力破解</button>
      </div>

      <p class="modal-hint modal-hint-error" id="decryptModalHint" aria-hidden="true"></p>
      <div class="modal-actions">
        <button type="button" class="btn btn-secondary" id="decryptModalCancel">取消</button>
      </div>
    </div>
  </div>

  <!-- 解密/破解进度条弹出层（只显示进度条与百分比） -->
  <div class="loading-overlay loading-overlay-progress" id="decryptProgressOverlay" aria-hidden="true">
    <div class="progress-card progress-card-decrypt">
      <div class="progress-bar-wrap">
        <div class="progress-bar" id="decryptProgressBar" style="width: 0%"></div>
      </div>
      <p class="progress-percent" id="decryptProgressPercent">0%</p>
    </div>
  </div>

  <!-- 加密进度条弹出层 -->
  <div class="loading-overlay loading-overlay-progress" id="encryptProgressOverlay" aria-hidden="true">
    <div class="progress-card">
      <p class="loading-text" id="encryptProgressText">加密中…</p>
      <div class="progress-bar-wrap">
        <div class="progress-bar" id="encryptProgressBar" style="width: 0%"></div>
      </div>
      <p class="progress-percent" id="encryptProgressPercent">0%</p>
    </div>
  </div>

  <!-- Loading 弹出层（解密/压缩等） -->
  <div class="loading-overlay" id="loadingOverlay" aria-hidden="true">
    <div class="loading-spinner"></div>
    <p class="loading-text" id="loadingText">处理中…</p>
  </div>

  <script src="https://cdn.jsdelivr.net/npm/pdf-lib-with-encrypt@1.2.1/dist/pdf-lib.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/pdf.js/3.11.174/pdf.min.js"></script>
  <script src="js/app.js"></script>
</body>
</html>
